# 医療情報システム向け TLS / 証明書設計まとめ

## 1. 背景・前提

本システムは、医療情報を取り扱うシステムとして、  
**医療情報ガイドライン（2024年版）** および  
**IPA「TLS暗号設定ガイドライン 3.0.1（高セキュリティ型）」**  
への準拠を前提に設計を行う。

- オープンなネットワーク（インターネット）を利用
- VPN（IPsec 等）は利用しない
- AWS 上にシステムを構築
- クライアントは Windows 端末
- Active Directory 環境は存在しない

---

## 2. ガイドライン要件の整理

### 医療情報ガイドライン（抜粋）

- HTTPS を利用する場合：
  - **TLS 1.3 以上に限定**
  - **クライアント証明書を利用した TLS クライアント認証（mTLS）を実施**
- システム・サービスの対応が困難な場合：
  - **TLS 1.2 + 高セキュリティ型設定** も可
- TLS 設定は IPA「TLS暗号設定ガイドライン 3.0.1」に準拠

### TLS暗号設定ガイドライン（高セキュリティ型）

- TLS1.3 / TLS1.2 のみ有効（TLS1.1 以下は無効）
- 強度不足の暗号スイート・鍵交換・ハッシュは全て無効化
- サーバ証明書の鍵長・署名アルゴリズム要件を満たすこと
- **mTLS（相互認証）を必須とは明記していない**

---

## 3. 解釈と判断

- **高セキュリティ型単体では mTLS 必須とは言えない**
- ただし、医療情報ガイドライン本文では
  - 「TLS1.3 + クライアント証明書認証」が明記されている
- よって：
  - 技術的には「TLS1.2 + 高セキュリティ型 + mTLSなし」も成立しうる
  - しかし **外部監査・レビューでは説明負荷が高い**

👉 **ガイドライン準拠を最も素直に示せる構成として mTLS を採用**

---

## 4. 採用方針（①案）

### 方針概要

- **TLS 1.3**
- **mTLS（クライアント証明書認証）**
- AWS マネージドサービスを最大限活用

### 採用理由

- 医療情報ガイドラインの要求を直接満たす
- 外部監査・社内レビュー時の説明が容易
- セキュリティポリシーとの整合性が高い

---

## 5. AWS 側構成の考え方（mTLS）

### サーバ証明書

- AWS Certificate Manager (ACM) を使用
- パブリック証明書（無料）
- 用途：
  - サーバ（API Gateway 等）の正当性証明
- クライアント証明書の CA とは **別でも問題なし**

### クライアント証明書と Truststore

- クライアント証明書：
  - 外部 CA または自前 CA で発行
- Truststore：
  - **クライアント証明書を発行した CA 証明書**
  - S3 に PEM 形式で配置
- API Gateway の動作：
  - クライアント証明書が  
    Truststore 内の CA によって署名されているかを検証
- Truststore に含めないもの：
  - クライアント証明書本体
  - 秘密鍵
  - PFX ファイル

---

## 6. 証明書発行元に関する整理

- サーバ証明書とクライアント証明書は：
  - **同じ CA である必要はない**
- 役割は独立：
  - サーバ証明書：通信先の正当性
  - クライアント証明書：通信元の正当性

---

## 7. 運用方針

### Windows 端末側に集約する作業

- クライアント証明書の：
  - 取得
  - インポート
  - ブラウザ／アプリへの設定
- 証明書更新時の再配布

### AWS 側の作業

- Truststore（CA証明書）を S3 に配置
- API Gateway で mTLS を有効化
- 証明書そのものの配布・管理は行わない

---

## 8. まとめ

- 技術的な最小構成よりも
  **「ガイドラインへの説明可能性」を重視**
- 一旦は **TLS1.3 + mTLS** で設計を確定
- 証明書運用の煩雑さは
  - Windows 端末側に集約することで AWS 側を簡素化
